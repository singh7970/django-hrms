{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Punch In/Out</title>

    <!-- Fonts and Icons -->
    <link href="{% static 'css/font-face.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/font-awesome-4.7/css/font-awesome.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/font-awesome-5/css/fontawesome-all.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="{% static 'vendor/bootstrap-4.1/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Vendor CSS -->
    <link href="{% static 'vendor/animsition/animsition.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/select2/select2.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.css' %}" rel="stylesheet">

    <!-- Theme -->
    <link href="{% static 'css/theme.css' %}" rel="stylesheet">

    <style>
        /* Optional: to limit scrollable height */
        .scroll-container {
            max-height: 90vh;
            overflow: hidden;
        }
    </style>
</head>
<body class="animsition">
<div class="page-wrapper">

    {% include 'sidebar.html' %}

    <div class="page-container">
        {% include 'navbar.html' %}

        <div class="main-content">
            <div class="section__content section__content--p30">
                <div class="scroll-container container-fluid">

                    <!-- Top Menu Buttons -->
                    <div class="d-flex justify-content-start gap-4 mb-4">
                        <div class="dropdown mr-3">
                            <a class="btn btn-light dropdown-toggle" href="#" data-toggle="dropdown">Time Dashboard</a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="{% url 'time_dashboard' %}">Dashboard</a>
                            </div>
                        </div>

                        <div class="dropdown mr-3">
                            <a class="btn btn-light dropdown-toggle" href="#" data-toggle="dropdown">Attendance</a>
                            <div class="dropdown-menu " >
                                <a class="dropdown-item" href="{% url 'punchin_out_view' %}">Punch In/Out</a>
                                <a class="dropdown-item" href="{% url 'attendance_records' %}">My Records</a>
                            </div>
                        </div>

                        <div class="dropdown mr-3">
                            <a class="btn btn-light dropdown-toggle" href="#" data-toggle="dropdown">Reports</a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#">Performance</a>
                            </div>
                        </div>
                    </div>

                    <!-- <span id="status-text" style="display: none;">{{ data.status }}</span> -->
                    <span id="status-text" style="display: none;" data-blocked="{{ block_access|yesno:'true,false' }}">{{ data.status }}</span>

                    {% if holiday_restriction %}
                        <div class="alert alert-info mt-2">
                            <i class="fas fa-calendar-check"></i> {{ holiday_message }}
                        </div>
                    {% elif weekend_restriction %}
                        <div class="alert alert-warning mt-2">
                            <i class="fas fa-calendar-times"></i> {{ weekend_message }}
                        </div>
                    {% elif disable_punch %}
                        <div class="alert alert-danger mt-2">You have been punched in for over 40 hours. Please contact HR.</div>
                    {% endif %}

                    <!-- Punch In Form -->
                  
                    <div class="card {% if data.status == 'PUNCHED_IN' or block_access or weekend_restriction or holiday_restriction %}d-none{% endif %}" id="punch-in-form">

                        <h3 class="card-title p-3">Punch In</h3>
                        <form id="form-punch-in" method="POST" action="{% url 'save_punch_in_data' %}" class="p-4">

                            <div id="message-box-in" class="d-none" style="padding: 10px; border-radius: 5px;"></div>


                            {% csrf_token %}
                            <div class="form-row mb-3">
                                <label>Date</label>
                                <input type="date" id="punch-in-date" name="date" class="form-control" readonly>
                            </div>
                            <div class="form-row mb-3">
                                <label>Time</label>
                                <input type="text" id="punch-in-time" name="time" class="form-control" readonly>
                            </div>
                            <div class="form-row mb-3">
                                <label>Note (optional)</label>
                                <textarea class="form-control" name="note" placeholder="Add a note"></textarea>
                            </div>
                            <div class="text-right">
                                <button type="submit" class="btn btn-primary" {% if disable_punch %}disabled{% endif %}>Punch In</button>
                            </div>
                        </form>
                    </div>

                    <!-- Punch Out Form -->
                 
                    <div class="card {% if data.status != 'PUNCHED_IN' or block_access or weekend_restriction or holiday_restriction %}d-none{% endif %}" id="punch-out-form">

                        <h3 class="card-title p-3">Punch Out</h3>
                        <form id="form-punch-out" method="POST" action="{% url 'save_punch_out_data' %}" class="p-4">
                            <div id="message-box-out" class="d-none" style="padding: 10px; border-radius: 5px;"></div>


                            {% csrf_token %}

                            <div class="form-row mb-3">
                                <label>Date</label>
                                <input type="date" id="punch-out-date" name="date" class="form-control" readonly>
                            </div>
                            <div class="form-row mb-3">
                                <label>Time</label>
                                <input type="text" id="punch-out-time" name="time" class="form-control" readonly>
                            </div>
                            <div class="form-row mb-3">
                                <label>Note (optional)</label>
                                <textarea class="form-control" name="note" placeholder="Add a note"></textarea>
                            </div>
                            <div class="text-right">
                                <button type="submit" class="btn btn-primary" {% if disable_punch %}disabled{% endif %}>Punch Out</button>
                               
                        </form>
                    </div>
                </div> <!-- scroll-container -->
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="{% static 'vendor/jquery-3.2.1.min.js' %}"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>

<script src="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.min.js' %}"></script>
<script src="{% static 'vendor/animsition/animsition.min.js' %}"></script>
<script src="{% static 'vendor/select2/select2.min.js' %}"></script>
<script>
    // Pass holiday data to JavaScript
    window.holidayRestriction = "{{ holiday_restriction|yesno:'true,false' }}".toLowerCase() === 'true';
    window.holidayMessage = "{{ holiday_message|escapejs }}";
</script>
<script src="{% static 'js/time.js' %}"></script>



</body>
</html>
